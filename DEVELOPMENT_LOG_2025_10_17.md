# 개발일지 - 2025.10.17 (금)

## 📋 전체 요약

이주메이트 서비스의 핵심 기능인 **부동산 매물 검색 및 지도 기반 탐색 시스템**을 구현했습니다. 사용자가 지도에서 직관적으로 매물을 찾아보고, 상세 정보를 확인할 수 있는 모바일 최적화 인터페이스를 완성했습니다.

---

## 🏠 주요 구현 기능

### 1. 지도 기반 매물 검색 시스템

#### **실시간 지도 탐색**
사용자가 지도를 움직이면 해당 영역의 매물이 자동으로 표시됩니다. 지도를 확대/축소하거나 이동할 때마다 현재 보이는 영역의 매물만 불러와 빠른 검색이 가능합니다.

**주요 기능**:
- 지도 이동 시 현재 위치의 매물 자동 로딩
- 매물이 많은 지역은 자동으로 그룹화하여 표시 (마커 클러스터링)
- 지도 중앙의 주소가 상단에 실시간으로 표시 (카카오 지오코더 API 활용)

**기술 구현**:
- 지도 영역(Bounds) 기반 필터링: 남서-북동 좌표를 API로 전송하여 해당 영역의 매물만 조회
- 500ms 디바운싱 적용: 지도를 빠르게 이동해도 불필요한 API 호출 방지
- 카카오맵 SDK의 MarkerClusterer 활용: 매물 10개 이상 시 자동 그룹화

#### **매물 마커 및 정보**
지도에 표시되는 각 매물 마커를 클릭하면:
- 해당 매물의 간단한 정보(가격, 주소)가 표시됩니다
- 하단 매물 목록이 자동으로 올라오며 선택한 매물을 강조합니다
- 매물이 밀집된 지역은 숫자로 표시되어 한눈에 파악할 수 있습니다

**기술 구현**:
- 마커 클릭 이벤트: 선택된 매물 ID 상태 업데이트
- 모달 높이 자동 조절: 선택 시 70%로 확장
- 선택된 매물의 좌표로 주소 역변환 (Geocoder API)

### 2. 드래그 가능한 매물 목록

#### **직관적인 인터페이스**
화면 하단의 매물 목록 영역을 손가락으로 위아래로 드래그할 수 있습니다:
- **아래로 내리기**: 지도를 더 넓게 보고 싶을 때 (10% 높이)
- **중간 위치**: 매물 목록을 간단히 확인할 때 (30% 높이)
- **위로 올리기**: 매물 목록을 자세히 볼 때 (70% 높이)

**기술 구현**:
- Touch/Mouse 이벤트 통합 처리: 모바일/데스크톱 모두 지원
- 3단계 스냅 포인트: 드래그 종료 시 가까운 높이로 자동 이동
- 모달 상태 관리: React useState로 높이(%) 제어

#### **매물 정보 표시**
각 매물 카드에는 다음 정보가 표시됩니다:
- 매물 대표 이미지 (API 제공 또는 주택 유형별 기본 이미지)
- 거래 유형 및 가격 (전세 2억, 월세 500/50 등)
- 정확한 주소
- 매물 클릭 시 상세 페이지로 이동

**기술 구현**:
- 가격 포맷팅 로직: 억 단위 자동 변환 (매매/전세), 보증금/월세 구분 (월세)
- 이미지 폴백 처리: 주택 종류(아파트/빌라/원룸)에 따른 기본 이미지 제공

### 3. 매물 상세 정보

#### **종합 정보 제공**
매물을 선택하면 다음과 같은 상세 정보를 확인할 수 있습니다:

**기본 정보**:
- 매물 사진 (여러 장 슬라이드 가능)
- 거래 유형 및 가격
- 상세 주소 및 위치
- 관리비 및 주차 정보

**공간 정보**:
- 전용면적/공급면적 (㎡ 및 평수)
- 방/욕실 개수
- 층수 정보 (현재층/전체층)
- 건물 준공년도
- 방향 (동향, 남향 등)

**교통 정보**:
- 대중교통 접근성 점수 (0-10점)
- 인근 버스 정류장 목록 및 거리
- 인근 지하철역 정보 및 노선

**편의시설 정보**:
- 주변 편의시설 요약 정보

**기술 구현**:
- 탭 기반 정보 구분: 기본정보/교통/편의시설 탭으로 정보 분류
- API 데이터 변환 레이어: 백엔드 데이터를 화면 표시용으로 가공 (예: 면적 ㎡→평 자동 변환)
- 이미지 슬라이더: 여러 매물 사진을 좌우 스와이프로 탐색
- JSON 데이터 파싱: 버스/지하철 정보를 리스트로 표시

### 4. 홈 화면

#### **배너 슬라이더**
주요 이벤트와 공지사항이 자동으로 슬라이드됩니다:
- 신규 가입 이벤트
- 프리미엄 매물 안내
- 전문가 상담 서비스 소개

**기술 구현**:
- 4초 자동 슬라이드: setInterval로 타이머 구현
- 인디케이터 점: 현재 슬라이드 위치 표시
- 터치로 슬라이드 수동 전환 가능

#### **주요 서비스 메뉴**
세 가지 핵심 서비스에 빠르게 접근할 수 있습니다:
- **부동산 찾기**: 지도 기반 매물 검색 (왼쪽 큰 카드)
- **전문가 매칭**: 부동산 전문가 상담 (오른쪽 상단 작은 카드, 준비 중)
- **정책 정보**: 부동산 관련 정책 및 뉴스 (오른쪽 하단 작은 카드)

**기술 구현**:
- CSS Grid 레이아웃: 비대칭 카드 배치 (1:1 비율에서 좌측 2행 차지, 우측 1행씩 2개)
- 그라디언트 배경: 각 카드별 테마 컬러
- 호버 애니메이션: 마우스 올릴 시 카드 상승 효과 (transform: translateY)

#### **정책 뉴스**
최신 부동산 정책 정보를 확인할 수 있습니다:
- 청약 제도 변경 사항
- 세금 감면 혜택
- 지원 프로그램 안내

#### **인기 매물**
조회수와 찜이 많은 인기 매물을 한눈에 볼 수 있습니다.

**데이터 연동 예정**:
- 현재는 정적 데이터로 표시
- 향후 실시간 조회수/찜 기반 정렬 기능 추가 예정

---

## 🔌 시스템 아키텍처

### 백엔드 (Django)
매물 데이터를 관리하고 지도 검색을 위한 API를 제공합니다:
- **매물 목록 조회 API**: `/api/listings/` (지도 영역 필터링 지원)
  - Query Parameter: `bounds` (남서위도, 남서경도, 북동위도, 북동경도)
  - Response: 매물 ID, 제목, 가격, 주소, 위도, 경도, 이미지, 주택종류
- **매물 상세 정보 조회 API**: `/api/listings/{id}/`
  - Response: 50개 필드의 상세 정보 (가격, 면적, 교통, 편의시설 등)
- **지리공간 데이터베이스**: PostGIS 활용하여 위도/경도 기반 효율적인 검색


### 프론트엔드 (Next.js)
사용자가 보는 모바일 웹 인터페이스입니다:
- **지도 라이브러리**: 카카오맵 JavaScript SDK v2
- **상태 관리**: React Hooks (useState, useEffect, useCallback)
- **스타일링**: styled-components (CSS-in-JS)
- **반응형 디자인**: 모바일 우선, 터치 이벤트 최적화

**주요 컴포넌트**:
- `KakaoMap`: 지도 표시 및 마커 관리
- `MobileLayout`: 공통 레이아웃 (상단/하단 네비게이션)
- `ListModal`: 드래그 가능한 매물 목록
- `TopNav` / `BottomNav`: 네비게이션 바

### 통신 흐름
1. **사용자가 지도를 움직임**
2. **프론트엔드**: 디바운싱 후 현재 지도 영역의 좌표(bounds) 추출
3. **API 요청**: `GET /api/listings/?bounds=37.5,127.0,37.6,127.1`
4. **백엔드**: PostGIS 쿼리로 해당 영역의 매물만 필터링하여 반환
5. **프론트엔드**: 받은 매물을 지도에 마커로 표시 (클러스터링 적용)
6. **사용자 클릭**: 마커 선택 시 해당 매물 ID로 상세 정보 조회
7. **API 요청**: `GET /api/listings/{id}/`
8. **화면 표시**: 상세 정보 페이지로 이동

---

## 🎯 사용자 시나리오

### 일반 사용자의 매물 검색 과정

1. **홈 화면 접속**
   - 배너에서 최신 이벤트 확인
   - "부동산 찾기" 버튼 클릭

2. **지도에서 매물 탐색**
   - 원하는 지역으로 지도 이동 (확대/축소, 드래그)
   - 해당 지역의 매물 마커 자동 표시
   - 상단에 현재 위치 주소 표시

3. **매물 선택**
   - 관심있는 매물 마커 클릭
   - 하단 매물 목록이 자동으로 올라옴
   - 선택한 매물 정보 확인

4. **상세 정보 확인**
   - 매물 카드 클릭하여 상세 페이지 이동
   - 매물 사진, 가격, 면적, 교통 정보 등 확인
   - 필요시 뒤로가기로 지도로 복귀

5. **다른 지역 탐색**
   - 지도를 다른 지역으로 이동
   - 새로운 매물 자동 로딩 및 표시
   - 여러 매물 비교

---

## 🔧 기술적 구현 사항

### 성능 최적화
- **지도 영역 필터링**: 
  - 구현: bounds 파라미터로 현재 화면의 남서-북동 좌표 전송
  - 효과: 전국 2,562개 중 현재 보이는 수십 개만 로딩하여 응답 속도 향상
  
- **마커 클러스터링**: 
  - 라이브러리: 카카오맵 MarkerClusterer
  - 임계값: 매물 10개 이상 시 자동 그룹화
  - 효과: 줌 아웃 시 지도 렌더링 성능 유지
  
- **디바운싱**: 
  - 구현: 500ms 지연 후 API 호출
  - 효과: 빠른 지도 이동 시 불필요한 API 호출 최소화 (초당 수십 번 → 초당 2번)

### 사용자 경험 개선
- **실시간 주소 표시**: 
  - API: 카카오 지오코더 coord2Address
  - 표시 형식: "읍/면/동 + 번지" (예: "역삼동 123")
  - 업데이트: 지도 이동 시마다 중앙 좌표 기준으로 변환
  
- **드래그 가능한 UI**: 
  - 이벤트: Touch/Mouse 통합 처리
  - 스냅 포인트: 10%, 30%, 70% (자동 고정)
  - 범위 제한: 최소 10% ~ 최대 90%
  
- **터치 최적화**: 
  - 버튼 최소 크기: 40px × 40px (iOS/Android 권장 크기)
  - 카드 간격: 12px (손가락 터치 오류 방지)
  - 스크롤 영역: 오버스크롤 처리

- **애니메이션**:
  - 모달 높이 전환: 0.3s cubic-bezier 이징
  - 카드 호버: translateY(-4px) + shadow 변화
  - 배너 슬라이드: 0.8s fade 전환

### 데이터 처리
- **가격 포맷팅**:
  - 억 단위 자동 변환: 200,000,000원 → "2.00억"
  - 월세 분리 표시: "보증금 500만 / 월 50만"
  
- **면적 단위 변환**:
  - API는 제곱미터로 제공
  - 화면은 "84.97㎡ (25.72평)" 형태로 표시
  
- **이미지 처리**:
  - 우선순위: API 제공 이미지 → 주택 유형별 기본 이미지
  - 기본 이미지: 아파트(apt*.jpg), 빌라(house*.jpg), 원룸(room*.jpg)
  - ID 기반 해시: 같은 매물은 항상 같은 기본 이미지 표시


---

## 📱 화면 구성

### 1. 홈 화면
```
┌─────────────────────────┐
│      상단 네비게이션      │
├─────────────────────────┤
│    배너 슬라이더 영역    │
│  (이벤트, 공지사항 등)   │
├─────────────────────────┤
│  ┌──────┐  ┌─────┐      │
│  │부동산│  │전문가│      │
│  │ 찾기 │  │매칭 │      │
│  │      │  ├─────┤      │
│  │      │  │정책 │      │
│  └──────┘  │정보 │      │
│            └─────┘      │
├─────────────────────────┤
│    정책 뉴스 리스트      │
├─────────────────────────┤
│    인기 매물 리스트      │
├─────────────────────────┤
│      하단 네비게이션      │
└─────────────────────────┘
```

### 2. 매물 검색 화면
```
┌─────────────────────────┐
│   상단바 (현재 주소)     │ ← 터치로 토글
├─────────────────────────┤
│                         │
│     전체 화면 지도       │
│   (매물 마커 표시)       │
│                         │
│  ┌───────────────────┐ │
│  │ ═══ (드래그바)    │ │
│  ├───────────────────┤ │
│  │  매물 목록         │ │ ← 드래그 가능
│  │  [매물 카드 1]    │ │   (10%/30%/70%)
│  │  [매물 카드 2]    │ │
│  └───────────────────┘ │
├─────────────────────────┤
│      하단 네비게이션      │
└─────────────────────────┘
```

### 3. 매물 상세 화면
```
┌─────────────────────────┐
│   상단바 (매물 상세)     │
├─────────────────────────┤
│    매물 이미지 슬라이더  │
│        (여러 장)         │
├─────────────────────────┤
│  가격: 전세 2억          │
│  주소: 서울시 강남구... │
├─────────────────────────┤
│  [기본정보] [교통] ...  │ ← 탭 메뉴
├─────────────────────────┤
│                         │
│    선택된 탭 내용 표시   │
│                         │
└─────────────────────────┘
```

